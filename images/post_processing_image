FROM ubuntu
RUN apt-get update && apt-get install -y git build-essential zlib1g-dev libncurses5-dev libncursesw5-dev python-dev python-setuptools
RUN easy_install pip
RUN pip install common
RUN pip install python-dateutil
RUN mkdir image_software
RUN cd /image_software && mkdir samtools_0_1_19 && cd samtools_0_1_19 && git clone --branch 0.1.19 https://github.com/samtools/samtools.git
RUN cd /image_software && mkdir samtools_1_0 && cd samtools_1_0 && git clone --branch 1.0 https://github.com/samtools/samtools.git
RUN cd /image_software/samtools_0_1_19/samtools/ && make
RUN cd /image_software/samtools_1_0 && git clone --branch 1.0 git://github.com/samtools/htslib.git
RUN cd /image_software/samtools_1_0/samtools/ && make
RUN cd /image_software && mkdir bwa_0_7_10
RUN cd /image_software/bwa_0_7_10 && git clone --branch 0.7.10 https://github.com/lh3/bwa.git
RUN cd /image_software/bwa_0_7_10/bwa && make

ARG CACHE_DATE=2016-01-01aa

RUN cd /image_software && git clone https://github.com/ENCODE-DCC/pipeline-container.git && cd /image_software/pipeline-container && git checkout dissection-idan
RUN cd /image_software/pipeline-container && git fetch && git pull

ENTRYPOINT ["python", "/image_software/pipeline-container/src/encode_post_map.py"]